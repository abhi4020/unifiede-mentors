<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Profile - FitZone</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="container" style="max-width:700px;margin:40px auto;">
    <h1 style="color:#004e89;">Your Profile</h1>
    <p style="color:#666;">Manage your personal information.</p>

    <form id="profilePageForm" class="profile-form" style="margin-top:20px;">
      <div class="form-group">
        <label>Full name</label>
        <input type="text" id="name" required />
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="email" disabled />
      </div>
      <div class="form-group">
        <label>Phone</label>
        <input type="tel" id="phone" />
      </div>
      <div style="display:flex;gap:10px;">
        <button type="submit" class="submit-btn">Save</button>
        <a href="dashboard.html" class="action-btn" style="display:inline-flex;align-items:center;justify-content:center;padding:8px 12px;text-decoration:none;color:#fff;background:#004e89;border-radius:6px;">Back</a>
      </div>
    </form>
  </main>

  <script>
    async function loadProfile() {
      try {
        const res = await fetch('/api/profile', { credentials: 'include' });
        const data = await res.json();
        if (!data.success) return window.location.href = 'login.html';
        const u = data.data;
        document.getElementById('name').value = u.name || '';
        document.getElementById('email').value = u.email || '';
        document.getElementById('phone').value = u.phone || '';
      } catch (e) {
        window.location.href = 'login.html';
      }
    }

    document.getElementById('profilePageForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      try {
        const res = await fetch('/api/profile', {
          method: 'PUT',
          credentials: 'include',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, phone })
        });
        const data = await res.json();
        if (data.success) {
          alert('Profile saved');
          window.location.href = 'dashboard.html';
        } else {
          alert('Save failed: ' + (data.error || 'Unknown'));
        }
      } catch (err) {
        alert('Network error: ' + err.message);
      }
    });

    loadProfile();
  </script>
</body>
</html>